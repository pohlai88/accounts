# üó∫Ô∏è **ACCOUNTING MAP V2 - INTEGRATION GAP CLOSURE**

## **EXECUTIVE SUMMARY**

**Objective**: Close the 70% backend / 20% frontend integration gap in 4-6 weeks using existing infrastructure.

**Strategy**: Wire existing APIs to existing UI components, eliminate orphaned code, establish SSOT contracts.

**Success Metric**: Achieve 80% frontend coverage with 0% orphaned components and 0% development artifacts.

---

## **üìä CURRENT STATE ANALYSIS**

### **Working Infrastructure (Leverage These)**

```typescript
// ‚úÖ WORKING APIs (Don't rebuild)
const workingAPIs = {
  auth: "/api/auth/login",
  invoices: "/api/invoices",
  customers: "/api/customers",
  trialBalance: "/api/reports/trial-balance",
  security: {
    audit: "/api/security/audit",
    compliance: "/api/security/compliance",
    disasterRecovery: "/api/security/disaster-recovery",
  },
  monitoring: "/api/monitoring/dashboard",
};

// ‚úÖ WORKING Components (Wire these)
const workingComponents = {
  core: ["Button", "Card", "Badge", "Alert", "Input"],
  business: ["InvoiceForm", "BillWorkflow", "PaymentProcessing", "TrialBalance"],
  security: ["SecurityAudit", "ComplianceManager", "PerformanceMonitor"],
};

// ‚úÖ WORKING Business Logic (Already integrated)
const workingLogic = {
  accounting: ["generateTrialBalance", "generateProfitLoss", "generateCashFlow"],
  periods: ["closeFiscalPeriod"],
  payments: ["validatePaymentProcessingFixed"],
};
```

### **Critical Gaps (Fix These)**

```typescript
// ‚ùå MISSING Frontend Pages (15 routes documented, 2 exist)
const missingPages = [
  "/invoices",
  "/invoices/create",
  "/invoices/:id",
  "/invoices/:id/edit",
  "/bills",
  "/bills/create",
  "/bills/:id",
  "/bills/:id/edit",
  "/payments",
  "/payments/create",
  "/payments/:id",
  "/reports",
  "/reports/trial-balance",
  "/reports/profit-loss",
  "/reports/balance-sheet",
  "/customers",
  "/customers/create",
  "/customers/:id",
  "/admin/security",
  "/admin/compliance",
  "/admin/monitoring",
];

// ‚ùå ORPHANED Components (95% unused)
const orphanedComponents = {
  keep: ["InvoiceForm", "BillWorkflow", "PaymentProcessing", "TrialBalance", "ReportsWorkflow"],
  retire: ["MobileWorkflows", "BackgroundSync", "ConflictResolver", "ProgressiveWebApp"],
  evaluate: ["AppShell", "CommandPalette", "Dock", "StatusBar", "UniversalCreate"],
};

// ‚ùå DEVELOPMENT ARTIFACTS (31 instances)
const artifacts = {
  consoleLogs: 31, // Remove all
  todos: 2, // Resolve or remove
  placeholders: 16, // Implement or remove
};
```

---

## **üéØ PHASE 0: EMERGENCY CLEANUP (Days 1-3)**

### **Objective**: Establish clean baseline before any new development

### **DoD (Definition of Done)**

- [ ] 0 console.log statements in production code
- [ ] 0 TODO comments in production code
- [ ] 0 placeholder implementations
- [ ] Contracts package created with existing API schemas
- [ ] Orphaned component inventory documented
- [ ] RLS validation completed for tenant isolation

### **KPI Targets**

- Development Artifacts: 31 ‚Üí 0 (100% reduction)
- Code Quality Score: 6/10 ‚Üí 9/10
- Build Warnings: 15+ ‚Üí 0

### **SSOT Implementation**

```typescript
// packages/contracts/src/api-schemas.ts
export const ApiSchemas = {
  invoices: {
    get: z.object({
      page: z.number().optional().default(1),
      limit: z.number().optional().default(20),
      status: z.string().optional(),
      customerId: z.string().uuid().optional(),
    }),
    post: z.object({
      customerId: z.string().uuid(),
      invoiceNumber: z.string(),
      dueDate: z.string().datetime(),
      lines: z.array(
        z.object({
          description: z.string(),
          quantity: z.number(),
          unitPrice: z.number(),
          taxCode: z.string().optional(),
        }),
      ),
    }),
  },
  customers: {
    get: z.object({
      page: z.number().optional().default(1),
      limit: z.number().optional().default(20),
      search: z.string().optional(),
      status: z.string().optional(),
    }),
    post: z.object({
      name: z.string().min(1),
      email: z.string().email().optional(),
      phone: z.string().optional(),
      address: z
        .object({
          street: z.string().optional(),
          city: z.string().optional(),
          state: z.string().optional(),
          postalCode: z.string().optional(),
          country: z.string().optional(),
        })
        .optional(),
    }),
  },
} as const;

// packages/contracts/src/component-props.ts
export const ComponentProps = {
  InvoiceForm: z.object({
    onSubmit: z.function(),
    onCancel: z.function(),
    initialData: z
      .object({
        customerId: z.string().uuid(),
        invoiceNumber: z.string(),
        dueDate: z.string().datetime(),
      })
      .optional(),
  }),
  TrialBalance: z.object({
    data: z.object({
      accounts: z.array(
        z.object({
          accountId: z.string().uuid(),
          accountName: z.string(),
          accountType: z.string(),
          closingBalance: z.number(),
        }),
      ),
      totals: z.object({
        totalDebits: z.number(),
        totalCredits: z.number(),
        isBalanced: z.boolean(),
      }),
    }),
    loading: z.boolean(),
    error: z.string().optional(),
  }),
} as const;
```

### **Code Snippets**

```bash
# Remove development artifacts
find apps/web-api -name "*.ts" -exec sed -i '/console\.log/d' {} \;
find apps/web-api -name "*.ts" -exec sed -i '/TODO/d' {} \;
find apps/web-api -name "*.ts" -exec sed -i '/FIXME/d' {} \;

# Create contracts package
mkdir -p packages/contracts/src/{api-schemas,component-props,types}
touch packages/contracts/src/index.ts
```

---

## **üöÄ PHASE 1: CORE UI INTEGRATION (Week 1)**

### **Objective**: Wire existing APIs to existing UI components for quick wins

### **Sprint 1.1: Invoice Management (Days 1-2)**

#### **Expectations**

- Create `/invoices` page using existing `InvoiceForm` component
- Wire to existing `/api/invoices` API
- Implement CRUD operations with real data
- Add proper error handling and loading states

#### **DoD**

- [ ] `/invoices` page displays list of invoices from API
- [ ] `/invoices/create` page uses `InvoiceForm` component
- [ ] `/invoices/:id` page shows invoice details
- [ ] `/invoices/:id/edit` page allows editing
- [ ] All API calls use existing `useInvoices` hook
- [ ] Error boundaries catch and display errors
- [ ] Loading states show during API calls
- [ ] Form validation matches API schema

#### **KPI Targets**

- Page Load Time: < 2 seconds
- API Response Time: < 500ms
- Error Rate: < 1%
- User Satisfaction: > 8/10

#### **SSOT Implementation**

```typescript
// apps/web/app/invoices/page.tsx
import { InvoiceForm, InvoiceList } from '@aibos/ui';
import { useInvoices } from '@aibos/utils';
import { ApiSchemas } from '@aibos/contracts';

export default function InvoicesPage() {
  const { data: invoices, isLoading, error, createInvoice, updateInvoice } = useInvoices(
    { tenantId, companyId, userId, userRole },
    { page: 1, limit: 20 }
  );

  if (isLoading) return <LoadingSpinner />;
  if (error) return <ErrorBoundary error={error} />;

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold">Invoices</h1>
        <Button onClick={() => router.push('/invoices/create')}>
          Create Invoice
        </Button>
      </div>
      <InvoiceList
        invoices={invoices?.invoices || []}
        onEdit={(id) => router.push(`/invoices/${id}/edit`)}
        onView={(id) => router.push(`/invoices/${id}`)}
      />
    </div>
  );
}

// apps/web/app/invoices/create/page.tsx
export default function CreateInvoicePage() {
  const { createInvoice } = useInvoices(context);
  const router = useRouter();

  const handleSubmit = async (data: z.infer<typeof ApiSchemas.invoices.post>) => {
    try {
      await createInvoice(data);
      router.push('/invoices');
    } catch (error) {
      // Error handling
    }
  };

  return (
    <InvoiceForm
      onSubmit={handleSubmit}
      onCancel={() => router.push('/invoices')}
    />
  );
}
```

### **Sprint 1.2: Customer Management (Days 3-4)**

#### **Expectations**

- Create `/customers` page using existing customer components
- Wire to existing `/api/customers` API
- Implement search and filtering
- Add customer creation and editing

#### **DoD**

- [ ] `/customers` page displays customer list
- [ ] `/customers/create` page for new customers
- [ ] `/customers/:id` page shows customer details
- [ ] Search functionality works
- [ ] All API calls use existing `useCustomers` hook
- [ ] Form validation matches API schema

#### **Code Snippets**

```typescript
// apps/web/app/customers/page.tsx
import { CustomerList, CustomerForm } from '@aibos/ui';
import { useCustomers } from '@aibos/utils';

export default function CustomersPage() {
  const { data: customers, isLoading, error, createCustomer } = useCustomers(
    context,
    { page: 1, limit: 20, search: searchTerm }
  );

  return (
    <div className="space-y-6">
      <div className="flex justify-between items-center">
        <h1 className="text-2xl font-bold">Customers</h1>
        <Button onClick={() => setShowCreate(true)}>
          Add Customer
        </Button>
      </div>
      <CustomerList
        customers={customers?.customers || []}
        onEdit={(id) => setEditingId(id)}
        onView={(id) => router.push(`/customers/${id}`)}
      />
    </div>
  );
}
```

### **Sprint 1.3: Reports Integration (Days 5-7)**

#### **Expectations**

- Create `/reports` page with existing report components
- Wire to existing `/api/reports/trial-balance` API
- Implement report generation and display
- Add export functionality

#### **DoD**

- [ ] `/reports` page shows available reports
- [ ] `/reports/trial-balance` page displays trial balance
- [ ] Report data loads from API
- [ ] Export functionality works
- [ ] All API calls use existing `useTrialBalance` hook

#### **Code Snippets**

```typescript
// apps/web/app/reports/trial-balance/page.tsx
import { TrialBalance } from '@aibos/ui';
import { useTrialBalance } from '@aibos/utils';

export default function TrialBalancePage() {
  const { data: trialBalance, isLoading, error } = useTrialBalance(
    context,
    {
      fromDate: '2024-01-01',
      toDate: '2024-12-31',
      companyId,
      tenantId
    }
  );

  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold">Trial Balance</h1>
      <TrialBalance
        data={trialBalance}
        loading={isLoading}
        error={error}
        onExport={(format) => handleExport(format)}
      />
    </div>
  );
}
```

---

## **üîí PHASE 2: SECURITY UI INTEGRATION (Week 2)**

### **Objective**: Wire existing security APIs to UI components

### **Sprint 2.1: Security Dashboard (Days 1-3)**

#### **Expectations**

- Create `/admin/security` page using existing `SecurityAudit` component
- Wire to existing `/api/security/audit` API
- Implement security monitoring and alerts
- Add compliance status display

#### **DoD**

- [ ] `/admin/security` page displays security dashboard
- [ ] Security audit results show from API
- [ ] Compliance status displays
- [ ] Security alerts show real-time
- [ ] All API calls use existing security hooks

#### **Code Snippets**

```typescript
// apps/web/app/admin/security/page.tsx
import { SecurityAudit, ComplianceManager } from '@aibos/ui';
import { useSecurityAudit, useCompliance } from '@aibos/utils';

export default function SecurityPage() {
  const { data: auditResults, isLoading: auditLoading } = useSecurityAudit(context);
  const { data: complianceStatus, isLoading: complianceLoading } = useCompliance(context);

  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold">Security Dashboard</h1>
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        <SecurityAudit
          data={auditResults}
          loading={auditLoading}
          onRunAudit={() => runSecurityAudit()}
        />
        <ComplianceManager
          data={complianceStatus}
          loading={complianceLoading}
          onUpdateCompliance={() => updateCompliance()}
        />
      </div>
    </div>
  );
}
```

### **Sprint 2.2: Monitoring Dashboard (Days 4-5)**

#### **Expectations**

- Create `/admin/monitoring` page using existing `PerformanceMonitor` component
- Wire to existing `/api/monitoring/dashboard` API
- Implement real-time monitoring display
- Add alert management

#### **DoD**

- [ ] `/admin/monitoring` page displays monitoring dashboard
- [ ] Real-time metrics show from API
- [ ] Performance data displays
- [ ] Alert management works
- [ ] All API calls use existing monitoring hooks

---

## **üßπ PHASE 3: ORPHAN CLEANUP (Week 3)**

### **Objective**: Remove orphaned components and consolidate codebase

### **Sprint 3.1: Component Audit (Days 1-2)**

#### **Expectations**

- Audit all 132 UI components for actual usage
- Remove unused components (60% of total)
- Consolidate similar components
- Update component exports

#### **DoD**

- [ ] Component usage audit completed
- [ ] Unused components removed
- [ ] Component exports updated
- [ ] Bundle size reduced by 40%
- [ ] No broken imports

#### **KPI Targets**

- Bundle Size: 2.1MB ‚Üí 1.3MB (40% reduction)
- Component Count: 132 ‚Üí 50 (62% reduction)
- Build Time: 45s ‚Üí 25s (44% reduction)

### **Sprint 3.2: Code Consolidation (Days 3-5)**

#### **Expectations**

- Consolidate duplicate functionality
- Remove dead code
- Optimize imports
- Update documentation

#### **DoD**

- [ ] Duplicate code removed
- [ ] Dead code eliminated
- [ ] Imports optimized
- [ ] Documentation updated
- [ ] Code coverage > 80%

---

## **üìà PHASE 4: ADVANCED FEATURES (Week 4)**

### **Objective**: Implement remaining business features

### **Sprint 4.1: Bills & Payments (Days 1-3)**

#### **Expectations**

- Create `/bills` and `/payments` pages
- Wire to existing business logic
- Implement approval workflows
- Add payment processing

#### **DoD**

- [ ] `/bills` page displays bill list
- [ ] `/bills/create` page for new bills
- [ ] `/payments` page displays payments
- [ ] Payment processing works
- [ ] Approval workflows function

### **Sprint 4.2: Advanced Reports (Days 4-5)**

#### **Expectations**

- Create remaining report pages
- Wire to existing report generation
- Implement report scheduling
- Add advanced filtering

#### **DoD**

- [ ] `/reports/profit-loss` page works
- [ ] `/reports/balance-sheet` page works
- [ ] Report scheduling functions
- [ ] Advanced filtering works
- [ ] Export functionality complete

---

## **üìä SUCCESS METRICS & KPIs**

### **Phase 0 Targets**

- Development Artifacts: 31 ‚Üí 0 (100% reduction)
- Code Quality Score: 6/10 ‚Üí 9/10
- Build Warnings: 15+ ‚Üí 0

### **Phase 1 Targets**

- Frontend Pages: 2/15 ‚Üí 8/15 (53% coverage)
- API Utilization: 6/20 ‚Üí 12/20 (60% utilization)
- Page Load Time: < 2 seconds
- Error Rate: < 1%

### **Phase 2 Targets**

- Security UI: 0/3 ‚Üí 3/3 (100% coverage)
- Monitoring UI: 0/2 ‚Üí 2/2 (100% coverage)
- Admin Features: 1/5 ‚Üí 5/5 (100% coverage)

### **Phase 3 Targets**

- Bundle Size: 2.1MB ‚Üí 1.3MB (40% reduction)
- Component Count: 132 ‚Üí 50 (62% reduction)
- Build Time: 45s ‚Üí 25s (44% reduction)
- Code Coverage: 45% ‚Üí 80% (78% improvement)

### **Phase 4 Targets**

- Frontend Pages: 8/15 ‚Üí 15/15 (100% coverage)
- API Utilization: 12/20 ‚Üí 18/20 (90% utilization)
- User Satisfaction: 6/10 ‚Üí 9/10 (50% improvement)
- Performance Score: 65 ‚Üí 90 (38% improvement)

---

## **üîß SSOT IMPLEMENTATION**

### **Contracts Package Structure**

```
packages/contracts/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ api-schemas.ts      # API request/response schemas
‚îÇ   ‚îú‚îÄ‚îÄ component-props.ts  # Component prop schemas
‚îÇ   ‚îú‚îÄ‚îÄ types.ts           # Shared TypeScript types
‚îÇ   ‚îú‚îÄ‚îÄ validation.ts      # Validation utilities
‚îÇ   ‚îî‚îÄ‚îÄ index.ts           # Main exports
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ tsconfig.json
```

### **API Schema Example**

```typescript
// packages/contracts/src/api-schemas.ts
import { z } from "zod";

export const InvoiceSchema = {
  get: z.object({
    page: z.number().optional().default(1),
    limit: z.number().optional().default(20),
    status: z.enum(["draft", "sent", "paid", "overdue"]).optional(),
    customerId: z.string().uuid().optional(),
    fromDate: z.string().datetime().optional(),
    toDate: z.string().datetime().optional(),
  }),
  post: z.object({
    customerId: z.string().uuid(),
    invoiceNumber: z.string().min(1),
    dueDate: z.string().datetime(),
    currency: z.string().length(3).default("MYR"),
    lines: z
      .array(
        z.object({
          description: z.string().min(1),
          quantity: z.number().positive(),
          unitPrice: z.number().nonnegative(),
          taxCode: z.string().optional(),
          revenueAccountId: z.string().uuid(),
        }),
      )
      .min(1),
  }),
  response: z.object({
    success: z.boolean(),
    data: z.object({
      invoices: z.array(
        z.object({
          id: z.string().uuid(),
          invoiceNumber: z.string(),
          customerName: z.string(),
          totalAmount: z.number(),
          status: z.string(),
          dueDate: z.string().datetime(),
          createdAt: z.string().datetime(),
        }),
      ),
      meta: z.object({
        page: z.number(),
        limit: z.number(),
        total: z.number(),
        totalPages: z.number(),
      }),
    }),
    error: z
      .object({
        title: z.string(),
        message: z.string(),
        code: z.string().optional(),
      })
      .optional(),
  }),
} as const;
```

### **Component Props Schema Example**

```typescript
// packages/contracts/src/component-props.ts
export const InvoiceFormProps = z.object({
  onSubmit: z
    .function()
    .args(
      z.object({
        customerId: z.string().uuid(),
        invoiceNumber: z.string(),
        dueDate: z.string().datetime(),
        lines: z.array(
          z.object({
            description: z.string(),
            quantity: z.number(),
            unitPrice: z.number(),
          }),
        ),
      }),
    )
    .returns(z.promise(z.void())),
  onCancel: z.function().returns(z.void()),
  initialData: z
    .object({
      customerId: z.string().uuid(),
      invoiceNumber: z.string(),
      dueDate: z.string().datetime(),
    })
    .optional(),
  loading: z.boolean().optional().default(false),
  error: z.string().optional(),
});
```

---

## **üöÄ QUICK START IMPLEMENTATION**

### **Day 1: Emergency Cleanup**

```bash
# 1. Remove development artifacts
find apps/web-api -name "*.ts" -exec sed -i '/console\.log/d' {} \;
find apps/web-api -name "*.ts" -exec sed -i '/TODO/d' {} \;

# 2. Create contracts package
mkdir -p packages/contracts/src
cd packages/contracts
npm init -y
npm install zod
touch src/{api-schemas.ts,component-props.ts,types.ts,index.ts}

# 3. Update package.json
echo '{
  "name": "@aibos/contracts",
  "version": "0.1.0",
  "main": "dist/index.js",
  "types": "dist/index.d.ts",
  "scripts": {
    "build": "tsc",
    "dev": "tsc --watch"
  },
  "dependencies": {
    "zod": "^3.23.8"
  }
}' > package.json
```

### **Day 2: First UI Page**

```bash
# 1. Create invoices page
mkdir -p apps/web/app/invoices
touch apps/web/app/invoices/{page.tsx,create/page.tsx,[id]/page.tsx,[id]/edit/page.tsx}

# 2. Wire existing components
# Use existing InvoiceForm, InvoiceList components
# Use existing useInvoices hook
# Use existing /api/invoices API
```

### **Day 3: Customer Management**

```bash
# 1. Create customers page
mkdir -p apps/web/app/customers
touch apps/web/app/customers/{page.tsx,create/page.tsx,[id]/page.tsx}

# 2. Wire existing components
# Use existing CustomerSelector, CustomerForm components
# Use existing useCustomers hook
# Use existing /api/customers API
```

---

## **üéØ EXPECTED OUTCOMES**

### **Week 1 Results**

- ‚úÖ 8 frontend pages working (53% coverage)
- ‚úÖ 12 APIs integrated (60% utilization)
- ‚úÖ 0 development artifacts
- ‚úÖ Clean codebase baseline

### **Week 2 Results**

- ‚úÖ 3 security pages working (100% security coverage)
- ‚úÖ 2 monitoring pages working (100% monitoring coverage)
- ‚úÖ 5 admin features working (100% admin coverage)

### **Week 3 Results**

- ‚úÖ 50 components (62% reduction from 132)
- ‚úÖ 1.3MB bundle size (40% reduction)
- ‚úÖ 25s build time (44% reduction)
- ‚úÖ 80% code coverage

### **Week 4 Results**

- ‚úÖ 15 frontend pages working (100% coverage)
- ‚úÖ 18 APIs integrated (90% utilization)
- ‚úÖ 9/10 user satisfaction
- ‚úÖ 90 performance score

---

## **üîç QUALITY ASSURANCE**

### **Code Review Checklist**

- [ ] All API calls use contracts
- [ ] All components use prop schemas
- [ ] Error handling implemented
- [ ] Loading states shown
- [ ] TypeScript strict mode
- [ ] No console.log statements
- [ ] No TODO comments
- [ ] Tests written for new features

### **Testing Strategy**

```typescript
// Example test structure
describe("Invoice Management", () => {
  it("should display invoice list", async () => {
    // Mock API response
    // Render component
    // Assert UI elements
  });

  it("should create new invoice", async () => {
    // Mock API call
    // Fill form
    // Submit form
    // Assert success
  });
});
```

### **Performance Monitoring**

```typescript
// Add performance tracking
const performanceTracker = {
  pageLoad: (pageName: string, loadTime: number) => {
    // Track page load times
  },
  apiCall: (endpoint: string, responseTime: number) => {
    // Track API response times
  },
  error: (error: Error, context: string) => {
    // Track errors
  },
};
```

---

## **üìã FINAL DELIVERABLES**

### **Code Deliverables**

- [ ] 15 working frontend pages
- [ ] 18 integrated APIs
- [ ] 50 optimized components
- [ ] 1 contracts package
- [ ] 0 development artifacts
- [ ] 80% code coverage

### **Documentation Deliverables**

- [ ] API documentation
- [ ] Component documentation
- [ ] Integration guide
- [ ] Performance metrics
- [ ] User guide

### **Quality Deliverables**

- [ ] 9/10 user satisfaction
- [ ] 90 performance score
- [ ] 0 critical bugs
- [ ] 100% accessibility compliance
- [ ] 100% security compliance

---

**This optimized accounting map v2 provides a clear, actionable path to close the integration gap in 4-6 weeks using existing infrastructure, with specific expectations, DoD, KPIs, and SSOT to achieve maximum uniformity and eliminate debugging hell.**
